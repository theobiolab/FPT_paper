CC = c++
CFLAGS = -O2 -Wall -shared -std=c++11 -fPIC -undefined dynamic_lookup
eigen  = -I $(shell pwd)/lib/eigen-3.4.0
boost  = -I $(shell pwd)/lib/boost_1_81_0
pybind11 = `python -m pybind11 --includes`
libs = -lmpfr -lmpc

install_libraries: 
	mkdir -p ./lib 
	cd lib

	wget https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz
	tar -xf gmp-6.3.0.tar.xz
	rm gmp-6.3.0.tar.xz

	wget https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.gz
	tar -xf boost_1_81_0.tar.gz
	rm boost_1_81_0.tar.gz

	wget https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.gz
	tar -xf eigen-3.4.0.tar.gz
	rm eigen-3.4.0.tar.gz

	wget https://www.mpfr.org/mpfr-current/mpfr-4.2.1.tar.xz
	tar -xf mpfr-4.2.1.tar.xz
	rm mpfr-4.2.1.tar.xz

	wget https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz
	tar -xf mpc-1.3.1.tar.gz
	rm mpc-1.3.1.tar.gz

	cd gmp-6.3.0
	./configure 
	make 
	sudo make install

	cd mpfr-4.2.1
	./configure 
	make 
	sudo make install

	cd mpc-1.3.1
	./configure 
	make 
	sudo make install

	mv -v boost_1_81_0 lib
	mv -v eigen-3.4.0 lib
	mv -v mpfr-4.2.1 lib
	mv -v gmp-6.3.0 lib
	mv -v mpc-1.3.1 lib
	


test_pybind: test/pybind_test.cpp
	$(CC) $(CFLAGS) $(pybind11) test/pybind_test.cpp -o test/pybind_test.so

test_boost: test/boost_test.cpp
	$(CC) $(CFLAGS) $(boost) test/boost_test.cpp -o test/boost_test.so $(libs)

test_mpfr: test/mpfr_test.cpp
	$(CC) $(CFLAGS) test/mpfr_test.cpp -o test/mpfr_test.so $(libs)

Ladder_3: src/Ladder_3_v3.cpp
	$(CC) $(CFLAGS) $(pybind11) $(eigen) $(boost) src/Ladder_3_v3.cpp -o Ladder_3_v3.so $(libs)

Ladder_6: src/Ladder_6_prec_100_v2.cpp
	$(CC) $(CFLAGS) $(pybind11) $(eigen) $(boost) src/Ladder_6_prec_100_v2.cpp -o Ladder_6_prec_100_v2.so $(libs)

install: 
	cp Ladder_3_v3.so $(shell pwd)/bin

install_container: 
	cp Ladder_3_v3.so /home/fpt/bin

clean: 
	rm Ladder_3_v3.so