CC = c++
CFLAGS = -O2 -Wall -shared -std=c++11 -fPIC -undefined dynamic_lookup
gmp = -I $(shell pwd)/lib/gmp-6.3.0
mpfr = -I $(shell pwd)/lib/mpfr-4.2.1/src/
lmpc = -I $(shell pwd)/lib/mpc-1.3.1/src/
eigen = -I $(shell pwd)/lib/eigen-3.4.0
boost = -I $(shell pwd)/lib/boost_1_81_0
pybind11 = `python -m pybind11 --includes`


dependencies: boost_and_eigen libgmp libmpfr libmpc
tests: test_pybind test_boost test_mpfr test_mpc test_gmp
ladders: Ladder_3 Ladder_6

boost_and_eigen:
	@mkdir -p ./lib 
	@cd lib

	wget https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.gz
	@tar -xf boost_1_81_0.tar.gz
	@rm boost_1_81_0.tar.gz

	wget https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.gz
	@tar -xf eigen-3.4.0.tar.gz
	@rm eigen-3.4.0.tar.gz

	@mv -v boost_1_81_0 lib
	@mv -v eigen-3.4.0 lib

libgmp:
	wget https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz
	@tar -xf gmp-6.3.0.tar.xz
	@rm gmp-6.3.0.tar.xz
	@cd gmp-6.3.0 && ./configure && make
	@mv -v gmp-6.3.0 lib

libmpfr:
	wget https://www.mpfr.org/mpfr-current/mpfr-4.2.1.tar.xz
	@tar -xf mpfr-4.2.1.tar.xz
	@rm mpfr-4.2.1.tar.xz
	@cd mpfr-4.2.1 && ./configure && make
	@mv -v mpfr-4.2.1 lib

libmpc:
	wget https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz
	@tar -xf mpc-1.3.1.tar.gz
	@rm mpc-1.3.1.tar.gz
	@cd mpc-1.3.1 && ./configure && make
	@mv -v mpc-1.3.1 lib

test_pybind: test/pybind_test.cpp
	$(CC) $(CFLAGS) $(pybind11) test/pybind_test.cpp -o test/pybind_test.so

test_boost: test/boost_test.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) $(boost) test/boost_test.cpp -o test/boost_test.so

test_mpfr: test/mpfr_test.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) test/mpfr_test.cpp -o test/mpfr_test.so

test_mpc: test/mpc_test.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) test/mpc_test.cpp -o test/mpc_test.so

test_gmp: test/gmp_test.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) test/gmp_test.cpp -o test/gmp_test.so

Ladder_3: src/Ladder_3_v3.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) $(pybind11) $(eigen) $(boost) src/Ladder_3_v3.cpp -o bin/Ladder_3_v3.so

Ladder_6: src/Ladder_6_prec_100_v2.cpp
	$(CC) $(CFLAGS) $(gmp) $(mpfr) $(lmpc) $(pybind11) $(eigen) $(boost) src/Ladder_6_prec_100_v2.cpp -o bin/Ladder_6_prec_100_v2.so
